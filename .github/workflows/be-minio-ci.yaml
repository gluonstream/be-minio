name: Microservice "be-minio" Java 25 CI

on:
  push:
    branches: [ "main" ]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: Set up JDK 25
        uses: actions/setup-java@v4
        with:
          java-version: '25'
          distribution: 'temurin'

      - name: Setup Gradle
        uses: gradle/actions/setup-gradle@v4

      - name: Build
        run: ./gradlew clean build

      - name: Login to Docker Hub
        uses: docker/login-action@v3
        with:
          username: ${{ secrets.DOCKERHUB_USERNAME }}
          password: ${{ secrets.DOCKERHUB_TOKEN }}

    # This builds the image and pushes it directly using the credentials from the step above
      - name: Build and Push Docker image
        run: |
          ./gradlew bootBuildImage \
            --imageName=gluonstream/be-minio:latest \
            --publishImage \
            -PdockerPublishUsername=${{ secrets.DOCKERHUB_USERNAME }} \
            -PdockerPublishPassword=${{ secrets.DOCKERHUB_TOKEN }}

#  -> old way to do it, required a Dockerfile at the root of the project
#      - name: Push Docker image
#        uses: docker/build-push-action@v5
#        with:
#          username: ${{ secrets.DOCKERHUB_USERNAME }}
#          password: ${{ secrets.DOCKERHUB_TOKEN }}
#          repository: gluonstream/be-minio
#          tags: latest, ${{ github.run_number }}

#  ->Code Quality Gate is Disabled: Reason It consumes a lot of tokens, as it schedules scan periodically and at the moment we don't need this
#  dependency-submission:
#
#    runs-on: ubuntu-latest
#    permissions:
#      contents: write
#
#    steps:
#      - uses: actions/checkout@v4
#      - name: Set up JDK 25
#        uses: actions/setup-java@v4
#        with:
#          java-version: '25'
#          distribution: 'temurin'
#
#      # Generates and submits a dependency graph, enabling Dependabot Alerts for all project dependencies.
#      # See: https://github.com/gradle/actions/blob/main/dependency-submission/README.md
#      - name: Generate and submit dependency graph
#        uses: gradle/actions/dependency-submission@af1da67850ed9a4cedd57bfd976089dd991e2582 # v4.0.0